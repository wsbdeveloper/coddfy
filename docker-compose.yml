version: '3.8'

services:
  # Banco de dados PostgreSQL
  db:
    image: postgres:15-alpine
    container_name: ccm_postgres
    environment:
      POSTGRES_DB: ccm_db
      POSTGRES_USER: ccm_user
      POSTGRES_PASSWORD: ccm_password
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ccm_user -d ccm_db"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - ccm_network

  # Backend Pyramid
  #backend:
  #  build:
  #    context: .
  #    dockerfile: Dockerfile.backend
  #  container_name: ccm_backend
  #  environment:
  #    DATABASE_URL: postgresql://ccm_user:ccm_password@db:5432/ccm_db
  #    JWT_SECRET: your-secret-key-change-in-production
  #    JWT_ALGORITHM: HS256
  #    JWT_EXPIRATION_HOURS: 24
  #    APP_ENV: development
  #    APP_HOST: 0.0.0.0
  #    APP_PORT: 6543
  #    CORS_ORIGINS: http://localhost:5173,http://localhost:3000
  #  ports:
  #    - "6543:6543"
  #  volumes:
  #    - ./backend:/app/backend
  #  depends_on:
  #    db:
  #      condition: service_healthy
  #  working_dir: /app/backend
  #  command: >
  #    sh -c "
  #      echo 'ðŸ”„ Aguardando banco de dados...' &&
  #      sleep 5 &&
  #      echo 'ðŸ“¦ Rodando migraÃ§Ãµes...' &&
  #      alembic -c alembic.ini upgrade head &&
  #      echo 'ðŸš€ Iniciando servidor backend...' &&
  #      python -m backend
  #    "
  #  networks:
  #    - ccm_network

  # Frontend React (desenvolvimento)
  #frontend:
  #  build:
  #    context: ./frontend
  #    dockerfile: Dockerfile.frontend
  #  container_name: ccm_frontend
  #  environment:
  #    VITE_API_URL: http://localhost:6543/api
  #  ports:
  #    - "5173:5173"
  #  volumes:
  #    - ./frontend:/app
  #    - /app/node_modules
  #  command: npm run dev -- --host 0.0.0.0
  #  depends_on:
  #    - backend
  #  networks:
  #    - ccm_network

volumes:
  postgres_data:

networks:
  ccm_network:
    driver: bridge

